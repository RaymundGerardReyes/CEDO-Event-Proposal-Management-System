<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Section 2 Form Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .primary {
            background-color: #007bff;
            color: white;
        }

        .secondary {
            background-color: #6c757d;
            color: white;
        }

        .debug {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .error {
            color: red;
        }

        .success {
            color: green;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Section 2 Form Debug</h1>

        <div class="debug">
            <h3>Debug Controls</h3>
            <button type="button" onclick="fillTestData()" class="secondary">Fill Test Data</button>
            <button type="button" onclick="debugFormValues()" class="secondary">Debug Form Values</button>
            <button type="button" onclick="testFormDataExtraction()" class="secondary">Test FormData Extraction</button>
        </div>

        <form id="section2-form" onsubmit="handleSubmit(event)">
            <div class="form-group">
                <label for="organizationName">Organization Name *</label>
                <input type="text" id="organizationName" name="organizationName" required>
            </div>

            <div class="form-group">
                <label for="organizationDescription">Organization Description</label>
                <textarea id="organizationDescription" name="organizationDescription" rows="3"></textarea>
            </div>

            <div class="form-group">
                <label for="contactName">Contact Person *</label>
                <input type="text" id="contactName" name="contactName" required>
            </div>

            <div class="form-group">
                <label for="contactEmail">Contact Email *</label>
                <input type="email" id="contactEmail" name="contactEmail" required>
            </div>

            <div class="form-group">
                <label for="contactPhone">Contact Phone</label>
                <input type="tel" id="contactPhone" name="contactPhone">
            </div>

            <button type="submit" class="primary">Save & Continue</button>
        </form>

        <div class="debug">
            <h3>Debug Output</h3>
            <div id="debug-output"></div>
        </div>
    </div>

    <script>
        function fillTestData() {
            const form = document.getElementById('section2-form');
            form.organizationName.value = 'Test Organization';
            form.organizationDescription.value = 'Test description';
            form.contactName.value = 'John Doe';
            form.contactEmail.value = 'john@example.com';
            form.contactPhone.value = '1234567890';

            log('‚úÖ Test data filled', 'success');
        }

        function debugFormValues() {
            const form = document.getElementById('section2-form');

            log('üîç Current form field values:');
            log(`organizationName: "${form.organizationName.value}"`);
            log(`contactName: "${form.contactName.value}"`);
            log(`contactEmail: "${form.contactEmail.value}"`);
            log(`contactPhone: "${form.contactPhone.value}"`);
            log(`organizationDescription: "${form.organizationDescription.value}"`);
        }

        function testFormDataExtraction() {
            const form = document.getElementById('section2-form');
            const formData = new FormData(form);

            log('üìã FormData extraction test:');
            log(`organizationName: "${formData.get('organizationName')}"`);
            log(`contactName: "${formData.get('contactName')}"`);
            log(`contactEmail: "${formData.get('contactEmail')}"`);
            log(`contactPhone: "${formData.get('contactPhone')}"`);
            log(`organizationDescription: "${formData.get('organizationDescription')}"`);

            // Test the submission data structure
            const submissionData = {
                organizationName: formData.get('organizationName')?.toString().trim() || '',
                organizationDescription: formData.get('organizationDescription')?.toString().trim() || '',
                contactName: formData.get('contactName')?.toString().trim() || '',
                contactEmail: formData.get('contactEmail')?.toString().trim() || '',
                contactPhone: formData.get('contactPhone')?.toString().trim() || '',
                organizationType: 'school-based',
                organizationTypes: ['school-based']
            };

            log('üöÄ Submission data structure:');
            log(JSON.stringify(submissionData, null, 2));

            // Check for empty required fields
            const requiredFields = {
                organizationName: submissionData.organizationName,
                contactName: submissionData.contactName,
                contactEmail: submissionData.contactEmail
            };

            const missingFields = Object.entries(requiredFields)
                .filter(([key, value]) => !value || value.trim().length === 0)
                .map(([key]) => key);

            if (missingFields.length > 0) {
                log(`‚ùå Missing required fields: ${missingFields.join(', ')}`, 'error');
            } else {
                log('‚úÖ All required fields have values', 'success');
            }
        }

        async function handleSubmit(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            // Extract submission data exactly like Section2_OrgInfo.jsx
            const submissionData = {
                organizationName: formData.get('organizationName')?.toString().trim() || '',
                organizationDescription: formData.get('organizationDescription')?.toString().trim() || '',
                contactName: formData.get('contactName')?.toString().trim() || '',
                contactEmail: formData.get('contactEmail')?.toString().trim() || '',
                contactPhone: formData.get('contactPhone')?.toString().trim() || '',
                organizationType: 'school-based',
                organizationTypes: ['school-based']
            };

            log('üöÄ Form submitted with data:');
            log(JSON.stringify(submissionData, null, 2));

            // Check for missing required fields
            const requiredFormFields = {
                organizationName: submissionData.organizationName,
                contactName: submissionData.contactName,
                contactEmail: submissionData.contactEmail
            };

            const missingFields = Object.entries(requiredFormFields)
                .filter(([key, value]) => !value || value.trim().length === 0)
                .map(([key]) => key);

            if (missingFields.length > 0) {
                log(`‚ùå Missing required form fields: ${missingFields.join(', ')}`, 'error');
                return;
            }

            log('‚úÖ Validation passed, would send to API', 'success');

            // Test API call (uncomment to actually test with backend)
            /*
            try {
                log('üì° Sending to API...');
                const response = await fetch('http://localhost:5000/api/proposals/section2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(submissionData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    log('‚úÖ API Success:', 'success');
                    log(JSON.stringify(result, null, 2));
                } else {
                    const error = await response.text();
                    log(`‚ùå API Error (${response.status}): ${error}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Network Error: ${error.message}`, 'error');
            }
            */
        }

        function log(message, type = '') {
            const output = document.getElementById('debug-output');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = typeof message === 'string' ? message : JSON.stringify(message, null, 2);
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;

            // Also log to console
            console.log(message);
        }

        // Clear debug output on page load
        document.addEventListener('DOMContentLoaded', function () {
            log('üîß Debug form loaded');
        });
    </script>
</body>

</html>